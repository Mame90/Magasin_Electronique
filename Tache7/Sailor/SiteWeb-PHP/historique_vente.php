

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Blog Single - Sailor Bootstrap Template</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-fv8WchckWyp8JPmIDJ6xI6YTwVMUu5RvsO5SLSlMBo1UqDTUx50Wb70zy9pXW5b/wST5SfcK6Pv6r4Utkzt+Lw==" crossorigin="anonymous" />

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/animate.css/animate.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: Sailor
  * Updated: Jul 27 2023 with Bootstrap v5.3.1
  * Template URL: https://bootstrapmade.com/sailor-free-bootstrap-theme/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>


    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        h2{
            color:#6c7a89 ;
            text-align:center;
            font-size: 3em;
            letter-spacing: 2px;
            line-height: 1.2;
            margin: 0 auto;
            width: 100%;
            max-width: 600px;
            padding: 0 10px;
            
        }

        h1 {
            text-align: center;
            color: #333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #4CAF50;
            color: white;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        a {
            text-decoration: none;
            color: #3498db;
        }

        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>


  <!-- ======= Header ======= -->
  <header id="header" class="fixed-top d-flex align-items-center">
    <div class="container d-flex align-items-center">

      <!-- <h1 class="logo me-auto"><a href="index.html">Bakeli</a></h1> -->
      <!-- Uncomment below if you prefer to use an image logo -->
      <a href="index.html" class="logo me-auto"><img src="assets/img/bakeli.png" alt="" class="img-fluid"></a>

      <!-- <nav id="navbar" class="navbar">
        <ul>
          <li><a href="index.html" class="active">Accueil</a></li>

          <li class="dropdown"><a href="#"><span>A propos</span> <i class="bi bi-chevron-down"></i></a>
            <ul>
              <li><a href="about.html">A propos</a></li>
              <li><a href="team.html">Equipe</a></li>
              <li><a href="testimonials.html">Temoignage</a></li>

              <li class="dropdown"><a href="#"><span>Nos offres </span> <i class="bi bi-chevron-right"></i></a>
                <ul>
                  <li><a href="#">Postuler pour un emploi</a></li>
                  <li><a href="#">Autres</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li><a href="services.html">Services</a></li>
          <li><a href="portfolio.html">Portfolio</a></li>
          <li><a href="inscription.html">Inscription</a></li>
          <li><a href="blog.html">Blog</a></li>

          <li><a href="contact.html">Nous-contactez</a></li>
          <li><a href="index.html" class="getstarted">Lancez-vous</a></li>
        </ul>
        <i class="bi bi-list mobile-nav-toggle"></i>
      </nav>.navbar -->

      <nav id="navbar" class="navbar">
        <ul>
          <!-- <li><a href="index.html" class="active">Accueil</a></li> -->

          <!-- <li class="dropdown"><a href="#"><span>A propos</span> <i class="bi bi-chevron-down"></i></a>
            <ul>
              <li><a href="./about.html">A propos</a></li>
              <li><a href="./team.html">Equipe</a></li>
              <li><a href="./testimonials.html">Temoignage</a></li>

              <li class="dropdown"><a href="#"><span>Nos offres </span> <i class="bi bi-chevron-right"></i></a>
                <ul>
                  <li><a href="#">Postuler pour un emploi</a></li>
                  <li><a href="#">Autres</a></li>
                </ul>
              </li>
            </ul>
          </li> -->
          <!-- <li><a href="services.html">Services</a></li> -->
          <!-- <li><a href="portfolio.html">Portfolio</a></li> -->
          <li><a href="contact.html" class="getstarted bg-primary">Ajoutez-Produit</a></li>
          <li><a href="affichage_stock.php" class="getstarted bg-primary">Listes-Produit</a></li>
          <li><a href="historique_vente.php" class="getstarted bg-primary">Historique-vente</a></li>
          <li><a href="logout.php" class="getstarted bg-danger">Déconnexion</a></li>
          <!-- <li><a href="dblog.html">Blog</a></li> -->
          
          
          
        </ul>
        <i class="bi bi-list mobile-nav-toggle"></i>
      </nav><!-- .navbar -->

    </div>
  </header><!-- End Header -->



<body>
    <!-- ... (votre code HTML actuel) ... -->

    <h1 style="margin-top: -1px;margin-bottom:10px">Stock Actuel</h1>

    <?php
    $servername = "localhost";
    $username = "root";
    $password = "";
    $dbname = "bd_authentification";

    $conn = new mysqli($servername, $username, $password, $dbname);

    if ($conn->connect_error) {
        die("Échec de la connexion à la base de données : " . $conn->connect_error);
    }
    // Récupération des transactions triées par date décroissante
    $result = $conn->query("SELECT ventes.*, produits.categorie, factures.nomClient
    FROM ventes
    INNER JOIN produits ON ventes.productId = produits.id
    INNER JOIN factures ON ventes.productId = factures.productId
    ORDER BY ventes.date DESC");
    


    if ($result->num_rows > 0) {
        echo "<h2>Historique de la vente</h2>";
        echo "<table border='1'>";
        echo "<tr><th>Produit</th><th>Catégorie</th><th>Quantité</th><th>Montant de la vente</th><th>Nom du client</th><th>Date</th><th>Impression</th></tr>";

        while ($row = $result->fetch_assoc()) {
          echo "<tr>";
          echo "<td>" . $row["nomProduit"] . "</td>";
          echo "<td>" . $row["categorie"] . "</td>";
          echo "<td>" . $row["nombreElement"] . "</td>";
          echo "<td>" . $row["MontantTotal"] . "<span style='color: green;'>" . ' &nbsp;&nbsp;FCFA' . "</span>" . "</td>";
          echo "<td>" . $row["nomClient"] . "</td>";
          // Formatez la date en français
          $date = new DateTime($row["date"]);
          $formattedDate = $date->format("d/m/Y à H:i:s");
          echo "<td>" . $formattedDate . "</td>";
          echo "<td><button onclick='imprimerRecu(\"" . $row["nomClient"] . "\", \"" . $formattedDate . "\", \"" . $row["nomProduit"] . "\", \"" . $row["nombreElement"] . "\", \"" . $row["MontantTotal"] . "\")'>Imprimer</button></td>";
         
          echo "</tr>";
      }

        echo "</table>";
    } else {
        echo "Aucune transaction enregistrée.";
    }

    // Fermeture de la connexion à la base de données (à inclure à la fin de votre page)
    $conn->close();
    ?>
    
    <script>
    function imprimerRecu(nomClient, date, nomProduit, prixUnitaire, montantTotal) {
        var myWindow = window.open('', '', 'width=800,height=600');
        myWindow.document.write('<html><head><title>Reçu de Vente</title>');
        myWindow.document.write('<style>');
        myWindow.document.write('body { font-family: Arial, sans-serif; }');
        myWindow.document.write('.recu-container { width: 80%; margin: auto; padding: 20px; border: 1px solid #ddd; border-radius: 10px; }');
        myWindow.document.write('.header { text-align: center; margin-bottom: 20px; }');
        myWindow.document.write('.header img { width: 100px; }');
        myWindow.document.write('.header h2 { margin: 0; }');
        myWindow.document.write('.content { margin-bottom: 20px; }');
        myWindow.document.write('.content p { margin: 5px 0; }');
        myWindow.document.write('.footer { text-align: center; margin-top: 20px; }');
        myWindow.document.write('</style>');
        myWindow.document.write('</head><body>');
        myWindow.document.write('<div class="recu-container">');
        myWindow.document.write('<div class="header"><img src="assets/img/bakeli.png" alt="Bakeli Logo"><h2>Reçu de Vente</h2></div>');
        myWindow.document.write('<div class="content">');
        myWindow.document.write('<p><strong>Nom du client: </strong>' + nomClient + '</p>');
        myWindow.document.write('<p><strong>Date: </strong>' + date + '</p>');
        myWindow.document.write('<p><strong>Nom du produit: </strong>' + nomProduit + '</p>');
        myWindow.document.write('<p><strong>Nombre de Produits: </strong>' + prixUnitaire + '</p>');
        myWindow.document.write('<p><strong>Montant total: </strong>' + montantTotal + ' FCFA</p>');
        myWindow.document.write('</div>');
        myWindow.document.write('<div class="footer"><p><strong>Merci pour votre achat !</strong></p></div>');
        myWindow.document.write('</div>');
        myWindow.document.write('</body></html>');
        myWindow.document.close();
        myWindow.focus();
        myWindow.print();
        myWindow.close();
    }
  </script>
</body>

</html>
